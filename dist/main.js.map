{"version":3,"sources":["main.js"],"names":["global","document","demand","provide","definition","DomElement","DomElementAppear","ComponentSense","functionMerge","functionDebounce","globalOnResize","instance","i","instances","localOnResize","call","candidate","image","boundingbox","dimensions","quality","url","self","this","properties","storage","uuid","parent","getParent","candidates","mql","matches","selector","checkSelector","visible","element","getBoundingClientRect","settings","modifier","width","height","ratio","offsetHeight","offsetWidth","scale","devicePixelRatio","replace","matchUrl","Math","round","setStyle","one","emit","setAttribute","setRatio","match","querySelectorAll","length","processSources","media","sources","getChildren","getAttribute","parseInt","on","push","container","Rescale","temp","caption","prototype","constructor","setStyles","position","display","padding","appendTo","src","placeholder","alt","top","left","margin","event","type","extend","min"],"mappings":"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","file":"main.js","sourcesContent":["(function(global, document, demand, provide) {\n\t'use strict';\n\n\tfunction definition(DomElement, DomElementAppear, ComponentSense, functionMerge, functionDebounce) {\n\t\tvar storage     = {},\n\t\t\tinstances   = [],\n\t\t\tmatchUrl    = /(.+?).(jpe?g|png|gif)$/,\n\t\t\tplaceholder = 'data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs=',\n\t\t\tprototype;\n\n\t\tfunction globalOnResize() {\n\t\t\tvar i = 0, instance;\n\n\t\t\tfor(; instance = instances[i]; i++) {\n\t\t\t\tlocalOnResize.call(instance);\n\t\t\t}\n\t\t}\n\n\t\tfunction localOnResize() {\n\t\t\tvar self       = this,\n\t\t\t\tproperties = storage[self.uuid],\n\t\t\t\tparent     = self.getParent(),\n\t\t\t\ti = 0, candidate, image, boundingbox, dimensions, quality, url;\n\n\t\t\tfor(; candidate = properties.candidates[i]; i++) {\n\t\t\t\tif((!candidate.mql || candidate.mql.matches) && (!candidate.selector || checkSelector.call(self, candidate.selector))) {\n\t\t\t\t\timage = properties.image;\n\n\t\t\t\t\tif(properties.visible) {\n\t\t\t\t\t\tboundingbox = image.element.getBoundingClientRect();\n\t\t\t\t\t\tdimensions  = properties.settings.modifier({\n\t\t\t\t\t\t\twidth:  boundingbox.width,\n\t\t\t\t\t\t\theight: boundingbox.width * (candidate.ratio || properties.ratio || parent.offsetHeight / parent.offsetWidth),\n\t\t\t\t\t\t\tscale:  (global.devicePixelRatio || 1) * 100\n\t\t\t\t\t\t});\n\t\t\t\t\t\tquality     = candidate.quality || properties.quality,\n\t\t\t\t\t\turl         = candidate.url.replace(matchUrl, '$1.' + Math.round(dimensions.width) + 'x' + Math.round(dimensions.height) + '@' + Math.round(dimensions.scale) + (quality ? '.' + quality : '') + '.$2');\n\n\t\t\t\t\t\timage\n\t\t\t\t\t\t\t.setStyle('visibility', 'hidden')\n\t\t\t\t\t\t\t.one('load', function() {\n\t\t\t\t\t\t\t\timage\n\t\t\t\t\t\t\t\t\t.setStyle('visibility', 'visible')\n\t\t\t\t\t\t\t\t\t.emit('rescale', candidate.url, url);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.setAttribute('src', url);\n\t\t\t\t\t}\n\n\t\t\t\t\tsetRatio.call(self, candidate.ratio);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsetRatio.call(self);\n\t\t}\n\n\t\tfunction checkSelector(selector) {\n\t\t\tvar self    = this,\n\t\t\t\tmatches = document.querySelectorAll(selector),\n\t\t\t\telement, i, match;\n\n\t\t\tif(matches.length) {\n\t\t\t\telement = self.element;\n\n\t\t\t\tfor(i = 0; match = matches[i]; i++) {\n\t\t\t\t\tif(match === element) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self.getParent(selector);\n\t\t}\n\n\t\tfunction processSources() {\n\t\t\tvar self       = this,\n\t\t\t\tsources    = self.getChildren('[itemprop=\"contentUrl\"]'),\n\t\t\t\tcandidates = [],\n\t\t\t\ti = 0, candidate, width, height, ratio, media;\n\n\t\t\tfor(; candidate = sources[i]; i++) {\n\t\t\t\twidth  = (width = candidate.getAttribute('width')) ? parseInt(width) : null;\n\t\t\t\theight = (height = candidate.getAttribute('height')) ? parseInt(height) : null;\n\t\t\t\tratio  = (width && height) ? height / width : null;\n\t\t\t\tmedia  = (media = candidate.getAttribute('media')) ? new ComponentSense(media).on('match unmatch', function() { localOnResize.call(self); }) : null;\n\n\t\t\t\tcandidates.push({\n\t\t\t\t\turl:      candidate.getAttribute('content'),\n\t\t\t\t\tratio:    ratio,\n\t\t\t\t\tquality:  candidate.getAttribute('quality'),\n\t\t\t\t\tmql:      media,\n\t\t\t\t\tselector: candidate.getAttribute('selector')\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn candidates;\n\t\t}\n\n\t\tfunction setRatio(ratio) {\n\t\t\tvar self       = this,\n\t\t\t\tparent     = self.getParent(),\n\t\t\t\tproperties = storage[self.uuid];\n\n\t\t\tproperties.container.setStyle('paddingBottom', ((ratio || properties.ratio || parent.offsetHeight / parent.offsetWidth) * 100) + '%');\n\n\t\t\treturn self;\n\t\t}\n\n\t\tfunction Rescale(element, settings) {\n\t\t\tvar self = DomElementAppear.prototype.constructor.call(this, element, settings),\n\t\t\t\tuuid = self.uuid,\n\t\t\t\ttemp, container, width, height, quality, caption, properties;\n\n\t\t\tcontainer  = new DomElement('<div />').setStyles({ position: 'relative', display: 'block', width: '100%', height: 0, padding: 0 }).appendTo(self);\n\t\t\twidth      = (temp = self.getChildren('[itemprop=\"width\"]')[0]) ? parseInt(temp.getAttribute('content')) : null;\n\t\t\theight     = (temp = self.getChildren('[itemprop=\"height\"]')[0]) ? parseInt(temp.getAttribute('content')) : null;\n\t\t\tquality    = (temp = self.getChildren('[itemprop=\"quality\"]')[0]) ? parseInt(temp.getAttribute('content')) : null;\n\t\t\tcaption    = (temp = self.getChildren('[itemprop=\"caption\"]')[0]) ? temp.getAttribute('content') : null;\n\n\t\t\tproperties = storage[uuid] = {\n\t\t\t\tvisible:    false,\n\t\t\t\tsettings:   functionMerge({}, prototype.settings, settings),\n\t\t\t\tratio:      (width && height) ? height / width : null,\n\t\t\t\tquality:    quality,\n\t\t\t\tcontainer:  container,\n\t\t\t\timage:      new DomElement('<img />', { src: placeholder, alt: caption || '' }, { position: 'absolute', display: 'block', width: '100%', height: '100%', top: '0', left: '0', margin: '0', padding: '0' }).appendTo(container),\n\t\t\t\tcandidates: processSources.call(self),\n\t\t\t\tcaption:    caption\n\t\t\t};\n\n\t\t\tinstances.push(self);\n\n\t\t\treturn setRatio\n\t\t\t\t.call(self)\n\t\t\t\t.on('appear disappear', function(event) {\n\t\t\t\t\tproperties.visible = (event.type === 'appear');\n\n\t\t\t\t\tlocalOnResize.call(self);\n\t\t\t\t});\n\t\t}\n\n\t\tnew DomElement(global)\n\t\t\t.on('resize orientationchange', functionDebounce(globalOnResize));\n\n\t\tprototype = DomElementAppear.extend(Rescale);\n\t\tprototype.settings = {\n\t\t\tmodifier: function(dimensions) {\n\t\t\t\t/*\n\t\t\t\tvar ratio = dimensions.height / dimensions.width;\n\n\t\t\t\tdimensions.width  = Math.ceil(dimensions.width / 50) * 50;\n\t\t\t\tdimensions.height = dimensions.width * ratio;\n\t\t\t\t*/\n\t\t\t\tdimensions.scale  = Math.min(200, dimensions.scale);\n\n\t\t\t\treturn dimensions;\n\t\t\t}\n\t\t};\n\n\t\treturn prototype;\n\t}\n\n\tprovide([ '/nucleus/dom/element', '/nucleus/dom/element/appear', '/nucleus/component/sense', '/nucleus/function/merge', '/nucleus/function/debounce' ], definition);\n}(this, document, demand, provide));"],"sourceRoot":"/source/"}