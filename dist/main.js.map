{"version":3,"sources":["main.js"],"names":["global","document","demand","provide","definition","DomElement","DomElementAppear","ComponentSense","functionMerge","functionDebounce","globalOnResize","instance","i","instances","localOnResize","call","candidate","image","boundingbox","dimensions","quality","url","self","this","properties","storage","uuid","parent","getParent","candidates","mql","matches","selector","checkSelector","visible","element","getBoundingClientRect","settings","modifier","width","height","ratio","offsetHeight","offsetWidth","scale","devicePixelRatio","replace","matchUrl","Math","round","setStyle","one","setAttribute","setRatio","match","querySelectorAll","length","processSources","media","sources","getChildren","getAttribute","parseInt","on","push","container","Adapt","temp","caption","prototype","constructor","setStyles","position","display","padding","appendTo","src","placeholder","alt","top","left","margin","event","type","extend","min"],"mappings":"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","file":"main.js","sourcesContent":["(function(global, document, demand, provide) {\n\t'use strict';\n\n\tfunction definition(DomElement, DomElementAppear, ComponentSense, functionMerge, functionDebounce) {\n\t\tvar storage     = {},\n\t\t\tinstances   = [],\n\t\t\tmatchUrl    = /(.+?).(jpe?g|png|gif)$/,\n\t\t\tplaceholder = 'data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs=',\n\t\t\tprototype;\n\n\t\tfunction globalOnResize() {\n\t\t\tvar i = 0, instance;\n\n\t\t\tfor(; instance = instances[i]; i++) {\n\t\t\t\tlocalOnResize.call(instance);\n\t\t\t}\n\t\t}\n\n\t\tfunction localOnResize() {\n\t\t\tvar self       = this,\n\t\t\t\tproperties = storage[self.uuid],\n\t\t\t\tparent     = self.getParent(),\n\t\t\t\ti = 0, candidate, image, boundingbox, dimensions, quality, url;\n\n\t\t\tfor(; candidate = properties.candidates[i]; i++) {\n\t\t\t\tif((!candidate.mql || candidate.mql.matches) && (!candidate.selector || checkSelector.call(self, candidate.selector))) {\n\t\t\t\t\timage = properties.image;\n\n\t\t\t\t\tif(properties.visible) {\n\t\t\t\t\t\tboundingbox = image.element.getBoundingClientRect();\n\t\t\t\t\t\tdimensions  = properties.settings.modifier({\n\t\t\t\t\t\t\twidth:  boundingbox.width,\n\t\t\t\t\t\t\theight: boundingbox.width * (candidate.ratio || properties.ratio || parent.offsetHeight / parent.offsetWidth),\n\t\t\t\t\t\t\tscale:  (global.devicePixelRatio || 1) * 100\n\t\t\t\t\t\t});\n\t\t\t\t\t\tquality     = candidate.quality || properties.quality,\n\t\t\t\t\t\turl         = candidate.url.replace(matchUrl, '$1.' + Math.round(dimensions.width) + 'x' + Math.round(dimensions.height) + '@' + Math.round(dimensions.scale) + (quality ? '.' + quality : '') + '.$2');\n\n\t\t\t\t\t\timage\n\t\t\t\t\t\t\t.setStyle('visibility', 'hidden')\n\t\t\t\t\t\t\t.one('load', function() {\n\t\t\t\t\t\t\t\timage.setStyle('visibility', 'visible');\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.setAttribute('src', url);\n\t\t\t\t\t}\n\n\t\t\t\t\tsetRatio.call(self, candidate.ratio);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsetRatio.call(self);\n\t\t}\n\n\t\tfunction checkSelector(selector) {\n\t\t\tvar self    = this,\n\t\t\t\tmatches = document.querySelectorAll(selector),\n\t\t\t\telement, i, match;\n\n\t\t\tif(matches.length) {\n\t\t\t\telement = self.element;\n\n\t\t\t\tfor(i = 0; match = matches[i]; i++) {\n\t\t\t\t\tif(match === element) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self.getParent(selector);\n\t\t}\n\n\t\tfunction processSources() {\n\t\t\tvar self       = this,\n\t\t\t\tsources    = self.getChildren('[itemprop=\"contentUrl\"]'),\n\t\t\t\tcandidates = [],\n\t\t\t\ti = 0, candidate, width, height, ratio, media;\n\n\t\t\tfor(; candidate = sources[i]; i++) {\n\t\t\t\twidth  = (width = candidate.getAttribute('width')) ? parseInt(width) : null;\n\t\t\t\theight = (height = candidate.getAttribute('height')) ? parseInt(height) : null;\n\t\t\t\tratio  = (width && height) ? height / width : null;\n\t\t\t\tmedia  = (media = candidate.getAttribute('media')) ? new ComponentSense(media).on('match unmatch', function() { localOnResize.call(self); }) : null;\n\n\t\t\t\tcandidates.push({\n\t\t\t\t\turl:      candidate.getAttribute('content'),\n\t\t\t\t\tratio:    ratio,\n\t\t\t\t\tquality:  candidate.getAttribute('quality'),\n\t\t\t\t\tmql:      media,\n\t\t\t\t\tselector: candidate.getAttribute('selector')\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn candidates;\n\t\t}\n\n\t\tfunction setRatio(ratio) {\n\t\t\tvar self       = this,\n\t\t\t\tparent     = self.getParent(),\n\t\t\t\tproperties = storage[self.uuid];\n\n\t\t\tproperties.container.setStyle('paddingBottom', ((ratio || properties.ratio || parent.offsetHeight / parent.offsetWidth) * 100) + '%');\n\n\t\t\treturn self;\n\t\t}\n\n\t\tfunction Adapt(element, settings) {\n\t\t\tvar self = DomElementAppear.prototype.constructor.call(this, element, settings),\n\t\t\t\tuuid = self.uuid,\n\t\t\t\ttemp, container, width, height, quality, caption, properties;\n\n\t\t\tcontainer  = new DomElement('<div />').setStyles({ position: 'relative', display: 'block', width: '100%', height: 0, padding: 0 }).appendTo(self);\n\t\t\twidth      = (temp = self.getChildren('[itemprop=\"width\"]')[0]) ? parseInt(temp.getAttribute('content')) : null;\n\t\t\theight     = (temp = self.getChildren('[itemprop=\"height\"]')[0]) ? parseInt(temp.getAttribute('content')) : null;\n\t\t\tquality    = (temp = self.getChildren('[itemprop=\"quality\"]')[0]) ? parseInt(temp.getAttribute('content')) : null;\n\t\t\tcaption    = (temp = self.getChildren('[itemprop=\"caption\"]')[0]) ? temp.getAttribute('content') : null;\n\n\t\t\tproperties = storage[uuid] = {\n\t\t\t\tvisible:    false,\n\t\t\t\tsettings:   functionMerge({}, prototype.settings, settings),\n\t\t\t\tratio:      (width && height) ? height / width : null,\n\t\t\t\tquality:    quality,\n\t\t\t\tcontainer:  container,\n\t\t\t\timage:      new DomElement('<img />', { src: placeholder, alt: caption || '' }, { position: 'absolute', display: 'block', width: '100%', height: '100%', top: '0', left: '0', margin: '0', padding: '0' }).appendTo(container),\n\t\t\t\tcandidates: processSources.call(self),\n\t\t\t\tcaption:    caption\n\t\t\t};\n\n\t\t\tinstances.push(self);\n\n\t\t\treturn setRatio\n\t\t\t\t.call(self)\n\t\t\t\t.on('appear disappear', function(event) {\n\t\t\t\t\tproperties.visible = (event.type === 'appear');\n\n\t\t\t\t\tlocalOnResize.call(self);\n\t\t\t\t});\n\t\t}\n\n\t\tnew DomElement(global)\n\t\t\t.on('resize orientationchange', functionDebounce(globalOnResize));\n\n\t\tprototype = DomElementAppear.extend(Adapt);\n\t\tprototype.settings = {\n\t\t\tmodifier: function(dimensions) {\n\t\t\t\t/*\n\t\t\t\tvar ratio = dimensions.height / dimensions.width;\n\n\t\t\t\tdimensions.width  = Math.ceil(dimensions.width / 50) * 50;\n\t\t\t\tdimensions.height = dimensions.width * ratio;\n\t\t\t\t*/\n\t\t\t\tdimensions.scale  = Math.min(200, dimensions.scale);\n\n\t\t\t\treturn dimensions;\n\t\t\t}\n\t\t};\n\n\t\treturn prototype;\n\t}\n\n\tprovide([ '/nucleus/dom/element', '/nucleus/dom/element/appear', '/nucleus/component/sense', '/nucleus/function/merge', '/nucleus/function/debounce' ], definition);\n}(this, document, demand, provide));"],"sourceRoot":"/source/"}