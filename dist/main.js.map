{"version":3,"sources":["main.js"],"names":["global","document","demand","provide","definition","DomElement","DomElementAppear","ComponentSense","functionMerge","functionDebounce","globalOnResize","instance","i","instances","localOnResize","call","candidate","image","boundingbox","dimensions","url","self","this","properties","storage","uuid","parent","getParent","candidates","mql","matches","selector","querySelector","visible","element","getBoundingClientRect","settings","modifier","width","height","ratio","offsetHeight","offsetWidth","scale","devicePixelRatio","replace","matchUrl","Math","round","setStyle","one","setAttribute","setRatio","processSources","media","sources","getChildren","getAttribute","parseInt","on","push","container","Adapt","temp","caption","prototype","constructor","setStyles","position","display","padding","appendTo","src","placeholder","alt","top","left","margin","event","type","extend","min"],"mappings":"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","file":"main.js","sourcesContent":["(function(global, document, demand, provide) {\n\t'use strict';\n\n\tfunction definition(DomElement, DomElementAppear, ComponentSense, functionMerge, functionDebounce) {\n\t\tvar storage     = {},\n\t\t\tinstances   = [],\n\t\t\tmatchUrl    = /(.+?).(jpe?g|png|gif)$/,\n\t\t\tplaceholder = 'data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs=',\n\t\t\tprototype;\n\n\t\tfunction globalOnResize() {\n\t\t\tvar i = 0, instance;\n\n\t\t\tfor(; instance = instances[i]; i++) {\n\t\t\t\tlocalOnResize.call(instance);\n\t\t\t}\n\t\t}\n\n\t\tfunction localOnResize() {\n\t\t\tvar self       = this,\n\t\t\t\tproperties = storage[self.uuid],\n\t\t\t\tparent     = self.getParent(),\n\t\t\t\ti = 0, candidate, image, boundingbox, dimensions, url;\n\n\t\t\tfor(; candidate = properties.candidates[i]; i++) {\n\t\t\t\tif((!candidate.mql || candidate.mql.matches) && (!candidate.selector || document.querySelector(candidate.selector))) {\n\t\t\t\t\timage = properties.image;\n\n\t\t\t\t\tif(properties.visible) {\n\t\t\t\t\t\tboundingbox = image.element.getBoundingClientRect();\n\t\t\t\t\t\tdimensions  = properties.settings.modifier({\n\t\t\t\t\t\t\twidth:  boundingbox.width,\n\t\t\t\t\t\t\theight: boundingbox.width * (candidate.ratio || properties.ratio || parent.offsetHeight / parent.offsetWidth),\n\t\t\t\t\t\t\tscale:  (global.devicePixelRatio || 1) * 100\n\t\t\t\t\t\t});\n\t\t\t\t\t\turl         = candidate.url.replace(matchUrl, '$1.' + Math.round(dimensions.width) + 'x' + Math.round(dimensions.height) + '@' + Math.round(dimensions.scale) + '.$2');\n\n\t\t\t\t\t\timage\n\t\t\t\t\t\t\t.setStyle('visibility', 'hidden')\n\t\t\t\t\t\t\t.one('load', function() {\n\t\t\t\t\t\t\t\timage.setStyle('visibility', 'visible');\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.setAttribute('src', url);\n\t\t\t\t\t}\n\n\t\t\t\t\tsetRatio.call(self, candidate.ratio);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsetRatio.call(self);\n\t\t}\n\n\t\tfunction processSources() {\n\t\t\tvar self       = this,\n\t\t\t\tsources    = self.getChildren('[itemprop=\"contentUrl\"]'),\n\t\t\t\tcandidates = [],\n\t\t\t\ti = 0, candidate, width, height, ratio, media;\n\n\t\t\tfor(; candidate = sources[i]; i++) {\n\t\t\t\twidth  = (width = candidate.getAttribute('width')) ? parseInt(width) : null;\n\t\t\t\theight = (height = candidate.getAttribute('height')) ? parseInt(height) : null;\n\t\t\t\tratio  = (width && height) ? height / width : null;\n\t\t\t\tmedia  = (media = candidate.getAttribute('media')) ? new ComponentSense(media).on('match unmatch', function() { localOnResize.call(self); }) : null;\n\n\t\t\t\tcandidates.push({\n\t\t\t\t\turl:      candidate.getAttribute('content'),\n\t\t\t\t\tratio:    ratio,\n\t\t\t\t\tmql:      media,\n\t\t\t\t\tselector: candidate.getAttribute('selector')\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn candidates;\n\t\t}\n\n\t\tfunction setRatio(ratio) {\n\t\t\tvar self       = this,\n\t\t\t\tparent     = self.getParent(),\n\t\t\t\tproperties = storage[self.uuid];\n\n\t\t\tproperties.container.setStyle('paddingBottom', ((ratio || properties.ratio || parent.offsetHeight / parent.offsetWidth) * 100) + '%');\n\n\t\t\treturn self;\n\t\t}\n\n\t\tfunction Adapt(element, settings) {\n\t\t\tvar self = DomElementAppear.prototype.constructor.call(this, element, settings),\n\t\t\t\tuuid = self.uuid,\n\t\t\t\ttemp, container, width, height, caption, properties;\n\n\t\t\tcontainer  = new DomElement('<div />').setStyles({ position: 'relative', display: 'block', width: '100%', height: 0, padding: 0 }).appendTo(self);\n\t\t\twidth      = (temp = self.getChildren('[itemprop=\"width\"]')[0]) ? parseInt(temp.getAttribute('content')) : null;\n\t\t\theight     = (temp = self.getChildren('[itemprop=\"height\"]')[0]) ? parseInt(temp.getAttribute('content')) : null;\n\t\t\tcaption    = (temp = self.getChildren('[itemprop=\"caption\"]')[0]) ? temp.getAttribute('content') : null;\n\n\t\t\tproperties = storage[uuid] = {\n\t\t\t\tvisible:    false,\n\t\t\t\tsettings:   functionMerge({}, prototype.settings, settings),\n\t\t\t\tratio:      (width && height) ? height / width : null,\n\t\t\t\tcontainer:  container,\n\t\t\t\timage:      new DomElement('<img />', { src: placeholder, alt: caption || '' }, { position: 'absolute', display: 'block', width: '100%', height: '100%', top: '0', left: '0', margin: '0', padding: '0' }).appendTo(container),\n\t\t\t\tcandidates: processSources.call(self),\n\t\t\t\tcaption:    caption\n\t\t\t};\n\n\t\t\tinstances.push(self);\n\n\t\t\treturn setRatio\n\t\t\t\t.call(self)\n\t\t\t\t.on('appear disappear', function(event) {\n\t\t\t\t\tproperties.visible = (event.type === 'appear');\n\n\t\t\t\t\tlocalOnResize.call(self);\n\t\t\t\t});\n\t\t}\n\n\t\tnew DomElement(global)\n\t\t\t.on('resize orientationchange', functionDebounce(globalOnResize));\n\n\t\tprototype = DomElementAppear.extend(Adapt);\n\t\tprototype.settings = {\n\t\t\tmodifier: function(dimensions) {\n\t\t\t\t/*\n\t\t\t\tvar ratio = dimensions.height / dimensions.width;\n\n\t\t\t\tdimensions.width  = Math.ceil(dimensions.width / 50) * 50;\n\t\t\t\tdimensions.height = dimensions.width * ratio;\n\t\t\t\t*/\n\t\t\t\tdimensions.scale  = Math.min(200, dimensions.scale);\n\n\t\t\t\treturn dimensions;\n\t\t\t}\n\t\t};\n\n\t\treturn prototype;\n\t}\n\n\tprovide([ '/nucleus/dom/element', '/nucleus/dom/element/appear', '/nucleus/component/sense', '/nucleus/function/merge', '/nucleus/function/debounce' ], definition);\n}(this, document, demand, provide));"],"sourceRoot":"/source/"}