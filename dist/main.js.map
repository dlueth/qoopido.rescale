{"version":3,"sources":["main.js"],"names":["global","document","demand","provide","definition","DomElement","DomElementAppear","ComponentSense","functionMerge","functionDebounce","globalOnResize","instance","i","instances","localOnResize","call","candidate","image","boundingbox","dimensions","url","self","this","properties","storage","uuid","parent","getParent","candidates","mql","matches","selector","checkSelector","visible","element","getBoundingClientRect","settings","modifier","width","height","ratio","offsetHeight","offsetWidth","scale","devicePixelRatio","replace","matchUrl","Math","round","setAttribute","setRatio","match","querySelectorAll","length","processSources","media","sources","getChildren","getAttribute","parseInt","on","push","container","setStyle","Adapt","temp","caption","prototype","constructor","setStyles","position","display","padding","appendTo","src","placeholder","alt","top","left","margin","event","type","extend","min"],"mappings":"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","file":"main.js","sourcesContent":["(function(global, document, demand, provide) {\n\t'use strict';\n\n\tfunction definition(DomElement, DomElementAppear, ComponentSense, functionMerge, functionDebounce) {\n\t\tvar storage     = {},\n\t\t\tinstances   = [],\n\t\t\tmatchUrl    = /(.+?).(jpe?g|png|gif)$/,\n\t\t\tplaceholder = 'data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs=',\n\t\t\tprototype;\n\n\t\tfunction globalOnResize() {\n\t\t\tvar i = 0, instance;\n\n\t\t\tfor(; instance = instances[i]; i++) {\n\t\t\t\tlocalOnResize.call(instance);\n\t\t\t}\n\t\t}\n\n\t\tfunction localOnResize() {\n\t\t\tvar self       = this,\n\t\t\t\tproperties = storage[self.uuid],\n\t\t\t\tparent     = self.getParent(),\n\t\t\t\ti = 0, candidate, image, boundingbox, dimensions, url;\n\n\t\t\tfor(; candidate = properties.candidates[i]; i++) {\n\t\t\t\tif((!candidate.mql || candidate.mql.matches) && (!candidate.selector || checkSelector.call(self, candidate.selector))) {\n\t\t\t\t\timage = properties.image;\n\n\t\t\t\t\tif(properties.visible) {\n\t\t\t\t\t\tboundingbox = image.element.getBoundingClientRect();\n\t\t\t\t\t\tdimensions  = properties.settings.modifier({\n\t\t\t\t\t\t\twidth:  boundingbox.width,\n\t\t\t\t\t\t\theight: boundingbox.width * (candidate.ratio || properties.ratio || parent.offsetHeight / parent.offsetWidth),\n\t\t\t\t\t\t\tscale:  (global.devicePixelRatio || 1) * 100\n\t\t\t\t\t\t});\n\t\t\t\t\t\turl         = candidate.url.replace(matchUrl, '$1.' + Math.round(dimensions.width) + 'x' + Math.round(dimensions.height) + '@' + Math.round(dimensions.scale) + '.$2');\n\n\t\t\t\t\t\timage.setAttribute('src', url);\n\t\t\t\t\t}\n\n\t\t\t\t\tsetRatio.call(self, candidate.ratio);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsetRatio.call(self);\n\t\t}\n\n\t\tfunction checkSelector(selector) {\n\t\t\tvar self    = this,\n\t\t\t\tmatches = document.querySelectorAll(selector),\n\t\t\t\telement, i, match;\n\n\t\t\tif(matches.length) {\n\t\t\t\telement = self.element;\n\n\t\t\t\tfor(i = 0; match = matches[i]; i++) {\n\t\t\t\t\tif(match === element) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self.getParent(selector);\n\t\t}\n\n\t\tfunction processSources() {\n\t\t\tvar self       = this,\n\t\t\t\tsources    = self.getChildren('[itemprop=\"contentUrl\"]'),\n\t\t\t\tcandidates = [],\n\t\t\t\ti = 0, candidate, width, height, ratio, media;\n\n\t\t\tfor(; candidate = sources[i]; i++) {\n\t\t\t\twidth  = (width = candidate.getAttribute('width')) ? parseInt(width) : null;\n\t\t\t\theight = (height = candidate.getAttribute('height')) ? parseInt(height) : null;\n\t\t\t\tratio  = (width && height) ? height / width : null;\n\t\t\t\tmedia  = (media = candidate.getAttribute('media')) ? new ComponentSense(media).on('match unmatch', function() { localOnResize.call(self); }) : null;\n\n\t\t\t\tcandidates.push({\n\t\t\t\t\turl:      candidate.getAttribute('content'),\n\t\t\t\t\tratio:    ratio,\n\t\t\t\t\tmql:      media,\n\t\t\t\t\tselector: candidate.getAttribute('selector')\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn candidates;\n\t\t}\n\n\t\tfunction setRatio(ratio) {\n\t\t\tvar self       = this,\n\t\t\t\tparent     = self.getParent(),\n\t\t\t\tproperties = storage[self.uuid];\n\n\t\t\tproperties.container.setStyle('paddingBottom', ((ratio || properties.ratio || parent.offsetHeight / parent.offsetWidth) * 100) + '%');\n\n\t\t\treturn self;\n\t\t}\n\n\t\tfunction Adapt(element, settings) {\n\t\t\tvar self = DomElementAppear.prototype.constructor.call(this, element, settings),\n\t\t\t\tuuid = self.uuid,\n\t\t\t\ttemp, container, width, height, caption, image, properties;\n\n\t\t\tcontainer  = new DomElement('<div />').setStyles({ position: 'relative', display: 'block', width: '100%', height: 0, padding: 0 }).appendTo(self);\n\t\t\twidth      = (temp = self.getChildren('[itemprop=\"width\"]')[0]) ? parseInt(temp.getAttribute('content')) : null;\n\t\t\theight     = (temp = self.getChildren('[itemprop=\"height\"]')[0]) ? parseInt(temp.getAttribute('content')) : null;\n\t\t\tcaption    = (temp = self.getChildren('[itemprop=\"caption\"]')[0]) ? temp.getAttribute('content') : null;\n\t\t\timage      = new DomElement('<img />', { src: placeholder, alt: caption || '' }, { position: 'absolute', display: 'block', width: '100%', height: '100%', top: '0', left: '0', margin: '0', padding: '0' }).appendTo(container);\n\n\t\t\tproperties = storage[uuid] = {\n\t\t\t\tvisible:    false,\n\t\t\t\tsettings:   functionMerge({}, prototype.settings, settings),\n\t\t\t\tratio:      (width && height) ? height / width : null,\n\t\t\t\tcontainer:  container,\n\t\t\t\timage:      image,\n\t\t\t\tcandidates: processSources.call(self),\n\t\t\t\tcaption:    caption\n\t\t\t};\n\n\t\t\tinstances.push(self);\n\n\t\t\treturn setRatio\n\t\t\t\t.call(self)\n\t\t\t\t.on('appear disappear', function(event) {\n\t\t\t\t\tproperties.visible = (event.type === 'appear');\n\n\t\t\t\t\tif(!properties.visible) {\n\t\t\t\t\t\timage.setAttribute('src', placeholder);\n\t\t\t\t\t}\n\n\t\t\t\t\tlocalOnResize.call(self);\n\t\t\t\t});\n\t\t}\n\n\t\tnew DomElement(global)\n\t\t\t.on('resize orientationchange', functionDebounce(globalOnResize));\n\n\t\tprototype = DomElementAppear.extend(Adapt);\n\t\tprototype.settings = {\n\t\t\tmodifier: function(dimensions) {\n\t\t\t\t/*\n\t\t\t\tvar ratio = dimensions.height / dimensions.width;\n\n\t\t\t\tdimensions.width  = Math.ceil(dimensions.width / 50) * 50;\n\t\t\t\tdimensions.height = dimensions.width * ratio;\n\t\t\t\t*/\n\t\t\t\tdimensions.scale  = Math.min(200, dimensions.scale);\n\n\t\t\t\treturn dimensions;\n\t\t\t}\n\t\t};\n\n\t\treturn prototype;\n\t}\n\n\tprovide([ '/nucleus/dom/element', '/nucleus/dom/element/appear', '/nucleus/component/sense', '/nucleus/function/merge', '/nucleus/function/debounce' ], definition);\n}(this, document, demand, provide));"],"sourceRoot":"/source/"}